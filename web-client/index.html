<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laundromat Client</title>
    <style>
        body { margin: 0; font-family: sans-serif; background: #222; color: white; }
        #container { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
        video { display: block; width: 100%; height: 100%; object-fit: cover; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        
        #ui-layer { position: absolute; bottom: 20px; left: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .controls { pointer-events: auto; display: flex; flex-wrap: wrap; gap: 10px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; max-width: 100%; box-sizing: border-box; }
        .stats { display: flex; gap: 15px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; font-size: 14px; }
        
        button { padding: 8px 16px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:disabled { background: #555; cursor: not-allowed; }
        button.recording { background: #dc3545; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        input { padding: 8px; border-radius: 4px; border: 1px solid #555; background: #333; color: white; }
        
        .status-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: #f00; margin-right: 5px; }
        .status-dot.connected { background: #0f0; }
    </style>
</head>
<body>
    <div id="container">
        <video id="videoElement" playsinline muted></video>
        <canvas id="overlayCanvas"></canvas>
        <div id="detectingOverlay" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:10;">
            <div style="font-size:32px; color:white; text-shadow:2px 2px 4px black;">üîç Detecting...</div>
        </div>
        
        <div id="ui-layer">
            <div class="stats">
                <div><span id="statusDot" class="status-dot"></span><span id="statusText">Disconnected</span></div>
                <div>Socks: <span id="totalSocks">0</span></div>
                <div>Pairs: <span id="pairsMatched">0</span></div>
                <div>Baskets: <span id="basketCount">0</span></div>
                <div>Time: <span id="inferenceTime">-</span></div>
            </div>
            
            <div class="controls">
                <button id="startBtn">Start Camera</button>
                <button id="stopBtn" disabled>Stop</button>
                <button id="recordBtn" disabled>‚è∫ Record</button>
                <div style="display:flex; gap:5px; align-items:center;">
                    <label>Top N:</label>
                    <input id="topNPairs" type="number" value="1" style="width: 40px;">
                </div>
                <div style="display:flex; gap:5px; align-items:center;">
                    <label>Mode:</label>
                    <select id="inferMode" style="padding: 6px;">
                        <option value="auto">Auto</option>
                        <option value="manual">Manual (tap)</option>
                    </select>
                </div>
                <div id="autoIntervalGroup" style="display:flex; gap:5px; align-items:center;">
                    <label>Sec:</label>
                    <input id="refreshInterval" type="number" value="2" style="width: 40px;">
                </div>
                <div style="display:flex; gap:5px; align-items:center;">
                    <label style="display:flex; align-items:center; gap:5px; cursor:pointer;">
                        <input id="excludeBasket" type="checkbox" style="width:16px; height:16px;">
                        Basket Exclusion
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Load OpenCV.js (WASM) -->
    <script src="https://docs.opencv.org/4.8.0/opencv.js" async></script>
    <!-- Load App -->
    <script src="app.js"></script>
</body>
</html>
